# æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç›®æ¬¡
1. [æ¦‚è¦](#æ¦‚è¦)
2. [æ–°ã—ã„è¨­è¨ˆã®ç‰¹å¾´](#æ–°ã—ã„è¨­è¨ˆã®ç‰¹å¾´)
3. [ç§»è¡Œæ‰‹é †](#ç§»è¡Œæ‰‹é †)
4. [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
5. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ğŸ¯ æ¦‚è¦

### å•é¡Œã®è§£æ±º
æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆv3ï¼‰ã¯ã€ä»¥ä¸‹ã®å•é¡Œã‚’è§£æ±ºã—ã¾ã™ï¼š

- **LLMã®æ·»å‰ŠçµæœãŒä¿å­˜ã•ã‚Œã¦ã„ãªã„å•é¡Œ**
  - `exercise_feedback`ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç¢ºå®Ÿã«ä¿å­˜
  - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã®åˆ†é¡ï¼ˆgeneral, improvement, strong_point, error, correctionï¼‰

- **user_sessionã«user_idãŒä¿å­˜ã•ã‚Œã¦ã„ãªã„å•é¡Œ**
  - ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§user_idã‚’å¿…é ˆé …ç›®ã¨ã—ã¦ç®¡ç†
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸­å¿ƒã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†

- **practice_historyãªã©ãŒsession_idã§ç®¡ç†ã•ã‚Œã¦ãŠã‚Šã€user_idãŒç´ã¥ã‘ã‚‰ã‚Œã¦ã„ãªã„å•é¡Œ**
  - ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒuser_idã§ç´ä»˜ã‘
  - æ¼”ç¿’ã‚¿ã‚¤ãƒ—åˆ¥ã®å±¥æ­´ç®¡ç†

### æ–°ã—ã„è¦ä»¶ã¸ã®å¯¾å¿œ
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ç®¡ç†ãŒã§ãã‚‹
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¿œã˜ã¦ã€å±¥æ­´ç®¡ç†ãŒã§ãã‚‹
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›å›ç­”ã¨LLMã®æ¡ç‚¹çµæœãŒuser_idã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ç®¡ç†ã§ãã‚‹
- âœ… ã©ã®æ¼”ç¿’ï¼ˆè‹±èªèª­è§£ã€è‡ªç”±è¨˜è¿°ãªã©ï¼‰ã‹ã‚‰ã®çµæœãªã®ã‹ãŒç®¡ç†ã§ãã‚‹
- âœ… ä½¿ç”¨ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆã‚„è«–æ–‡æ¤œç´¢ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ™ãƒ¼ã‚¹ã§ç®¡ç†ã§ãã‚‹
- âœ… å±¥æ­´ç®¡ç†ã‚‚æ¼”ç¿’ã”ã¨ã«ç®¡ç†ã§ãã€å‚ç…§ã§ãã‚‹

---

## ğŸ—ï¸ æ–°ã—ã„è¨­è¨ˆã®ç‰¹å¾´

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸­å¿ƒã®ç®¡ç†

```sql
-- ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§user_idã‚’å¿…é ˆé …ç›®ã¨ã—ã¦ç®¡ç†
CREATE TABLE exercise_sessions (
    session_id UUID PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES users(user_id),  -- å¿…é ˆ
    exercise_type_id INTEGER NOT NULL,
    -- ...
);
```

### 2. æ¼”ç¿’ã‚¿ã‚¤ãƒ—åˆ¥ã®å±¥æ­´ç®¡ç†

```sql
-- æ¼”ç¿’ã‚«ãƒ†ã‚´ãƒªã¨ã‚¿ã‚¤ãƒ—ã®éšå±¤ç®¡ç†
exercise_categories (ã‚«ãƒ†ã‚´ãƒª)
â”œâ”€â”€ exercise_types (æ¼”ç¿’ã‚¿ã‚¤ãƒ—)
    â”œâ”€â”€ exercise_sessions (ã‚»ãƒƒã‚·ãƒ§ãƒ³)
        â”œâ”€â”€ exercise_inputs (å…¥åŠ›)
        â”œâ”€â”€ exercise_scores (ã‚¹ã‚³ã‚¢)
        â””â”€â”€ exercise_feedback (ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯)
```

### 3. LLMæ·»å‰Šçµæœã®ç¢ºå®Ÿãªä¿å­˜

```sql
-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç¢ºå®Ÿã«ä¿å­˜
CREATE TABLE exercise_feedback (
    feedback_id UUID PRIMARY KEY,
    session_id UUID NOT NULL,
    feedback_content TEXT NOT NULL,
    feedback_type VARCHAR(20),  -- general, improvement, strong_point, error, correction
    ai_model VARCHAR(50),
    tokens_used INTEGER,
    created_at TIMESTAMP
);
```

### 4. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆãƒ»è«–æ–‡æ¤œç´¢å±¥æ­´

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ™ãƒ¼ã‚¹ã§ã®ç®¡ç†
CREATE TABLE keyword_generation_history (
    keyword_id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    exercise_type_id INTEGER,
    input_text TEXT NOT NULL,
    generated_keywords TEXT[] NOT NULL,
    -- ...
);

CREATE TABLE paper_search_history (
    search_id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    exercise_type_id INTEGER,
    search_query TEXT NOT NULL,
    search_results JSONB NOT NULL,
    -- ...
);
```

---

## ğŸ”„ ç§»è¡Œæ‰‹é †

### Step 1: æ–°ã—ã„ã‚¹ã‚­ãƒ¼ãƒã®ä½œæˆ

1. **Supabaseã®SQL Editorã«ã‚¢ã‚¯ã‚»ã‚¹**
   ```
   Supabase Dashboard â†’ SQL Editor
   ```

2. **æ–°ã—ã„ã‚¹ã‚­ãƒ¼ãƒã®SQLã‚’å®Ÿè¡Œ**
   ```sql
   -- docs/new_database_schema.sql ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å®Ÿè¡Œ
   ```

3. **åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥**
   ```sql
   -- æ¼”ç¿’ã‚«ãƒ†ã‚´ãƒªã®æŒ¿å…¥
   INSERT INTO exercise_categories (category_name, display_name, description, icon, color, sort_order) VALUES
   ('adoption_exam', 'æ¡ç”¨è©¦é¨“ç³»', 'åŒ»å¸«æ¡ç”¨è©¦é¨“å¯¾ç­–ã®æ¼”ç¿’', 'ğŸ“‹', '#3B82F6', 1),
   ('english_reading', 'è‹±èªèª­è§£ç³»', 'åŒ»å­¦è‹±èªèª­è§£ã®æ¼”ç¿’', 'ğŸ“–', '#10B981', 2),
   ('free_writing', 'è‡ªç”±è¨˜è¿°ç³»', 'è‡ªç”±è¨˜è¿°å•é¡Œã®æ¼”ç¿’', 'âœï¸', '#F59E0B', 3),
   ('interview', 'é¢æ¥ç³»', 'é¢æ¥å¯¾ç­–ã®æ¼”ç¿’', 'ğŸ¤', '#8B5CF6', 4);

   -- æ¼”ç¿’ã‚¿ã‚¤ãƒ—ã®æŒ¿å…¥
   INSERT INTO exercise_types (category_id, type_name, display_name, description, difficulty_level, estimated_duration_minutes, sort_order) VALUES
   (1, 'prefecture_adoption', 'çœŒç·æ¡ç”¨è©¦é¨“', 'çœŒç«‹ç—…é™¢æ¡ç”¨è©¦é¨“å¯¾ç­–', 3, 45, 1),
   (2, 'english_reading', 'è‹±èªèª­è§£', 'åŒ»å­¦è«–æ–‡ã®è‹±èªèª­è§£', 2, 30, 1),
   (3, 'free_writing', 'è‡ªç”±è¨˜è¿°', 'åŒ»ç™‚ç¾å ´ã§ã®è‡ªç”±è¨˜è¿°å•é¡Œ', 4, 60, 1),
   (4, 'interview_prep', 'é¢æ¥æº–å‚™', 'åŒ»å¸«é¢æ¥å¯¾ç­–', 3, 40, 1);
   ```

### Step 2: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ

```sql
-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_exercise_sessions_user_history 
ON exercise_sessions(user_id, created_at DESC, status) 
INCLUDE (exercise_type_id, theme, duration_seconds);

CREATE INDEX IF NOT EXISTS idx_exercise_scores_session 
ON exercise_scores(session_id, score_category) 
INCLUDE (score_value, max_score);

-- ãã®ä»–ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚‚ä½œæˆ
```

### Step 3: Row Level Security (RLS) ã®æœ‰åŠ¹åŒ–

```sql
-- RLSã‚’æœ‰åŠ¹åŒ–
ALTER TABLE exercise_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE exercise_inputs ENABLE ROW LEVEL SECURITY;
ALTER TABLE exercise_scores ENABLE ROW LEVEL SECURITY;
ALTER TABLE exercise_feedback ENABLE ROW LEVEL SECURITY;
ALTER TABLE keyword_generation_history ENABLE ROW LEVEL SECURITY;
ALTER TABLE paper_search_history ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_statistics ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_activity_log ENABLE ROW LEVEL SECURITY;

-- ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ
CREATE POLICY user_own_sessions ON exercise_sessions
    FOR ALL USING (user_id = auth.uid()::uuid);

-- ãã®ä»–ã®ãƒãƒªã‚·ãƒ¼ã‚‚ä½œæˆ
```

### Step 4: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œ

1. **ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ**
   ```bash
   python migrate_to_v3.py
   ```

2. **ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª**
   ```sql
   -- ç§»è¡Œã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
   SELECT COUNT(*) FROM exercise_sessions;
   SELECT COUNT(*) FROM exercise_inputs;
   SELECT COUNT(*) FROM exercise_scores;
   SELECT COUNT(*) FROM exercise_feedback;
   ```

### Step 5: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ›´æ–°

1. **æ–°ã—ã„ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®ä½¿ç”¨**
   ```python
   # æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’æ–°ã—ã„ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã«å¤‰æ›´
   from modules.database_adapter_v3 import db_adapter_v3
   
   # ä½¿ç”¨ä¾‹
   success = db_adapter_v3.save_practice_history(data)
   history = db_adapter_v3.load_practice_history()
   ```

2. **ãƒšãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰ã®æ›´æ–°**
   ```python
   # æ—¢å­˜ã®ãƒšãƒ¼ã‚¸ã§æ–°ã—ã„ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’ä½¿ç”¨
   import streamlit as st
   from modules.database_adapter_v3 import db_adapter_v3
   
   # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç¢ºèª
   if db_adapter_v3.is_available():
       # æ–°ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨
       pass
   else:
       # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
       pass
   ```

---

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```python
from modules.database_adapter_v3 import db_adapter_v3

# ç·´ç¿’å±¥æ­´ã®ä¿å­˜
data = {
    'type': 'è‹±èªèª­è§£',
    'inputs': {
        'question': 'åŒ»å­¦è«–æ–‡ã®å†…å®¹ã«ã¤ã„ã¦',
        'answer': 'æ‚£è€…ã®æ²»ç™‚åŠ¹æœã«ã¤ã„ã¦...'
    },
    'feedback': 'è‰¯ã„å›ç­”ã§ã™ã€‚ã•ã‚‰ã«è©³ã—ã...',
    'scores': {
        'clinical_accuracy': 8.5,
        'practical_thinking': 7.0
    }
}

success = db_adapter_v3.save_practice_history(data)
```

### 2. å±¥æ­´ã®å–å¾—

```python
# å…¨å±¥æ­´ã®å–å¾—
history = db_adapter_v3.load_practice_history()

# ç‰¹å®šã®æ¼”ç¿’ã‚¿ã‚¤ãƒ—ã®å±¥æ­´
english_history = db_adapter_v3.get_practice_history_by_type('english_reading')

# ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆå±¥æ­´
keyword_history = db_adapter_v3.get_keyword_history()

# è«–æ–‡æ¤œç´¢å±¥æ­´
paper_history = db_adapter_v3.get_paper_search_history()
```

### 3. æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ç›´æ¥ä½¿ç”¨

```python
from modules.database_v3 import db_manager_v3

# æ¼”ç¿’ã‚¿ã‚¤ãƒ—ã®å–å¾—
exercise_types = db_manager_v3.get_exercise_types()

# å®Œå…¨ãªæ¼”ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¿å­˜
success = db_manager_v3.save_complete_exercise_session(
    exercise_type_id=1,
    theme="åŒ»å­¦è«–æ–‡ã®èª­è§£",
    inputs=[('question', 'è«–æ–‡ã®å†…å®¹'), ('answer', 'å›ç­”å†…å®¹')],
    scores=[('clinical_accuracy', 8.5, 10.0)],
    feedback="è‰¯ã„å›ç­”ã§ã™ã€‚",
    ai_model="gemini-pro"
)

# ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¥æ­´ã®å–å¾—
history = db_manager_v3.get_user_history(exercise_type_id=1)
```

### 4. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆãƒ»è«–æ–‡æ¤œç´¢ã®ä¿å­˜

```python
# ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆå±¥æ­´ã®ä¿å­˜
success = db_manager_v3.save_keyword_generation(
    input_text="åŒ»å­¦è«–æ–‡ã®å†…å®¹",
    generated_keywords=["æ²»ç™‚åŠ¹æœ", "æ‚£è€…", "è‡¨åºŠè©¦é¨“"],
    exercise_type_id=1,
    ai_model="gemini-pro"
)

# è«–æ–‡æ¤œç´¢å±¥æ­´ã®ä¿å­˜
success = db_manager_v3.save_paper_search(
    search_query="åŒ»å­¦è«–æ–‡ æ²»ç™‚åŠ¹æœ",
    search_results=[{"title": "è«–æ–‡1", "abstract": "è¦ç´„1"}],
    selected_papers=[{"title": "è«–æ–‡1"}],
    exercise_type_id=1,
    ai_model="gemini-pro"
)
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Database not available` ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ–¹æ³•**:
```python
# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
import os
print(os.getenv('SUPABASE_URL'))
print(os.getenv('SUPABASE_ANON_KEY'))

# æ¥ç¶šãƒ†ã‚¹ãƒˆ
from modules.database_v3 import db_manager_v3
status = db_manager_v3.test_connection()
print(status)
```

#### 2. å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶**: å±¥æ­´ãƒšãƒ¼ã‚¸ã§ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œãªã„

**è§£æ±ºæ–¹æ³•**:
```python
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç¢ºèª
from modules.database_adapter_v3 import db_adapter_v3
status = db_adapter_v3.get_database_status()
print(status)

# å±¥æ­´ã®ç›´æ¥ç¢ºèª
history = db_adapter_v3.load_practice_history()
print(f"å±¥æ­´ä»¶æ•°: {len(history)}")
```

#### 3. LLMæ·»å‰ŠçµæœãŒä¿å­˜ã•ã‚Œãªã„

**ç—‡çŠ¶**: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒä¿å­˜ã•ã‚Œãªã„

**è§£æ±ºæ–¹æ³•**:
```python
# ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¿å­˜ã®ç¢ºèª
from modules.database_v3 import db_manager_v3

# ç›´æ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ä¿å­˜
success = db_manager_v3.session_manager.save_exercise_feedback(
    session_id="session_id",
    feedback_content="ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å†…å®¹",
    feedback_type="general",
    ai_model="gemini-pro"
)
print(f"ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¿å­˜: {success}")
```

#### 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæ­£ã—ãè¨­å®šã•ã‚Œãªã„

**ç—‡çŠ¶**: user_idãŒnullã¾ãŸã¯ä¸æ­£

**è§£æ±ºæ–¹æ³•**:
```python
# ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ç¢ºèª
from modules.database_v3 import db_manager_v3
user_id = db_manager_v3.get_current_user_id()
print(f"ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: {user_id}")

# ãƒ–ãƒ©ã‚¦ã‚¶ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆã®ç¢ºèª
fingerprint = db_manager_v3.get_browser_fingerprint()
print(f"ãƒ–ãƒ©ã‚¦ã‚¶ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ: {fingerprint}")
```

### ãƒ‡ãƒãƒƒã‚°ç”¨ã®é–¢æ•°

```python
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è©³ç´°çŠ¶æ…‹ã‚’ç¢ºèª
def debug_database_status():
    from modules.database_adapter_v3 import db_adapter_v3
    
    status = db_adapter_v3.test_connection()
    print("=== ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ ===")
    print(f"åˆ©ç”¨å¯èƒ½: {status.get('available', False)}")
    print(f"æ¥ç¶šãƒ†ã‚¹ãƒˆ: {status.get('test_result', 'unknown')}")
    
    if status.get('available'):
        print(f"æ¼”ç¿’ã‚¿ã‚¤ãƒ—æ•°: {len(status.get('exercise_types', []))}")
        print(f"ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: {status.get('current_user_id', 'unknown')}")
    
    return status

# å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®è©³ç´°ç¢ºèª
def debug_history_data():
    from modules.database_adapter_v3 import db_adapter_v3
    
    history = db_adapter_v3.load_practice_history(limit=10)
    print("=== å±¥æ­´ãƒ‡ãƒ¼ã‚¿ ===")
    print(f"å±¥æ­´ä»¶æ•°: {len(history)}")
    
    for i, item in enumerate(history[:3]):
        print(f"å±¥æ­´{i+1}:")
        print(f"  ã‚¿ã‚¤ãƒ—: {item.get('type', 'unknown')}")
        print(f"  æ—¥ä»˜: {item.get('date', 'unknown')}")
        print(f"  å…¥åŠ›æ•°: {len(item.get('inputs', {}))}")
        print(f"  ã‚¹ã‚³ã‚¢æ•°: {len(item.get('scores', {}))}")
        print(f"  ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é•·: {len(item.get('feedback', ''))}")
    
    return history
```

---

## ğŸ“ æ³¨æ„äº‹é …

### 1. ç§»è¡Œæ™‚ã®æ³¨æ„

- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä½œæˆ**: ç§»è¡Œå‰ã«å¿…ãšãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—
- **æ®µéšçš„ãªç§»è¡Œ**: æœ¬ç•ªç’°å¢ƒã§ã¯æ®µéšçš„ã«ç§»è¡Œã‚’å®Ÿæ–½
- **ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ç¢ºèª**: æœ¬ç•ªç§»è¡Œå‰ã«ãƒ†ã‚¹ãƒˆç’°å¢ƒã§å‹•ä½œç¢ºèª

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®

- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ´»ç”¨**: é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
- **ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–**: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨**: é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è€ƒæ…®

- **RLSã®æœ‰åŠ¹åŒ–**: Row Level Securityã‚’å¿…ãšæœ‰åŠ¹åŒ–
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼**: é©åˆ‡ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚’å®Ÿè£…
- **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–ã‚’æ¤œè¨

---

*ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚æœ€æ–°ç‰ˆã¯GitHubãƒªãƒã‚¸ãƒˆãƒªã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚* 